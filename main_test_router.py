import asyncio

from aiogram import Router, F
from aiogram.fsm.context import FSMContext
from aiogram.types import CallbackQuery, Message, ReplyKeyboardRemove
from aiogram.utils.keyboard import InlineKeyboardBuilder

from config import bot
from src.keyboard import menu_keyboard_maker
from src.states import UserStates, SpielbergerTest

test_router = Router()


# -------------------- –í–û–ü–†–û–°–´ --------------------
ST_QUESTIONS = [  # –°–∏—Ç—É–∞—Ç–∏–≤–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å (20 –≤–æ–ø—Ä–æ—Å–æ–≤)
    "1. –Ø —Å–ø–æ–∫–æ–µ–Ω",
    "2. –ú–Ω–µ –Ω–∏—á—Ç–æ –Ω–µ —É–≥—Ä–æ–∂–∞–µ—Ç",
    "3. –Ø –Ω–∞—Ö–æ–∂—É—Å—å –≤ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–∏",
    "4. –Ø –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ —Å–∫–æ–≤–∞–Ω",
    "5. –Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Å–≤–æ–±–æ–¥–Ω–æ",
    "6. –Ø —Ä–∞—Å—Å—Ç—Ä–æ–µ–Ω",
    "7. –ú–µ–Ω—è –≤–æ–ª–Ω—É—é—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –Ω–µ—É–¥–∞—á–∏",
    "8. –Ø –æ—â—É—â–∞—é –¥—É—à–µ–≤–Ω—ã–π –ø–æ–∫–æ–π",
    "9. –Ø –≤—Å—Ç—Ä–µ–≤–æ–∂–µ–Ω",
    "10. –Ø –∏—Å–ø—ã—Ç—ã–≤–∞—é —á—É–≤—Å—Ç–≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—è",
    "11. –Ø —É–≤–µ—Ä–µ–Ω –≤ —Å–µ–±–µ",
    "12. –Ø –Ω–µ—Ä–≤–Ω–∏—á–∞—é",
    "13. –Ø –Ω–µ –Ω–∞—Ö–æ–∂—É —Å–µ–±–µ –º–µ—Å—Ç–∞",
    "14. –Ø –≤–∑–≤–∏–Ω—á–µ–Ω",
    "15. –Ø –Ω–µ —á—É–≤—Å—Ç–≤—É—é —Å–∫–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏, –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ—Å—Ç–∏",
    "16. –Ø –¥–æ–≤–æ–ª–µ–Ω",
    "17. –Ø –æ–∑–∞–±–æ—á–µ–Ω",
    "18. –Ø —Å–ª–∏—à–∫–æ–º –≤–æ–∑–±—É–∂–¥—ë–Ω, –∏ –º–Ω–µ –Ω–µ –ø–æ —Å–µ–±–µ",
    "19. –ú–Ω–µ —Ä–∞–¥–æ—Å—Ç–Ω–æ",
    "20. –ú–Ω–µ –ø—Ä–∏—è—Ç–Ω–æ",
]

LT_QUESTIONS = [  # –õ–∏—á–Ω–æ—Å—Ç–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å (20 –≤–æ–ø—Ä–æ—Å–æ–≤)
    "1. –£ –º–µ–Ω—è –±—ã–≤–∞–µ—Ç –ø—Ä–∏–ø–æ–¥–Ω—è—Ç–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
    "2. –Ø –±—ã–≤–∞—é —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω—ã–º",
    "3. –Ø –ª–µ–≥–∫–æ –º–æ–≥—É —Ä–∞—Å—Å—Ç—Ä–æ–∏—Ç—å—Å—è",
    "4. –Ø —Ö–æ—Ç–µ–ª –±—ã –±—ã—Ç—å —Ç–∞–∫–∏–º –∂–µ —É–¥–∞—á–ª–∏–≤—ã–º, –∫–∞–∫ –∏ –¥—Ä—É–≥–∏–µ",
    "5. –Ø —Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞—é –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏ –∏ –¥–æ–ª–≥–æ –Ω–µ –º–æ–≥—É –æ –Ω–∏—Ö –∑–∞–±—ã—Ç—å",
    "6. –Ø —á—É–≤—Å—Ç–≤—É—é –ø—Ä–∏–ª–∏–≤ —Å–∏–ª, –∂–µ–ª–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å",
    "7. –Ø —Å–ø–æ–∫–æ–µ–Ω, —Ö–ª–∞–¥–Ω–æ–∫—Ä–æ–≤–µ–Ω –∏ —Å–æ–±—Ä–∞–Ω",
    "8. –ú–µ–Ω—è —Ç—Ä–µ–≤–æ–∂–∞—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏",
    "9. –Ø —Å–ª–∏—à–∫–æ–º –ø–µ—Ä–µ–∂–∏–≤–∞—é –∏–∑-–∑–∞ –ø—É—Å—Ç—è–∫–æ–≤",
    "10. –Ø –±—ã–≤–∞—é –≤–ø–æ–ª–Ω–µ —Å—á–∞—Å—Ç–ª–∏–≤",
    "11. –Ø –≤—Å—ë –ø—Ä–∏–Ω–∏–º–∞—é –±–ª–∏–∑–∫–æ –∫ —Å–µ—Ä–¥—Ü—É",
    "12. –ú–Ω–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–µ–±–µ",
    "13. –Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –±–µ–∑–∑–∞—â–∏—Ç–Ω—ã–º",
    "14. –Ø —Å—Ç–∞—Ä–∞—é—Å—å –∏–∑–±–µ–≥–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π –∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π",
    "15. –£ –º–µ–Ω—è –±—ã–≤–∞–µ—Ç —Ö–∞–Ω–¥—Ä–∞",
    "16. –Ø –±—ã–≤–∞—é –¥–æ–≤–æ–ª–µ–Ω",
    "17. –í—Å—è–∫–∏–µ –ø—É—Å—Ç—è–∫–∏ –æ—Ç–≤–ª–µ–∫–∞—é—Ç –∏ –≤–æ–ª–Ω—É—é—Ç –º–µ–Ω—è",
    "18. –ë—ã–≤–∞–µ—Ç, —á—Ç–æ —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –Ω–µ—É–¥–∞—á–Ω–∏–∫–æ–º",
    "19. –Ø —É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫",
    "20. –ú–µ–Ω—è –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ, –∫–æ–≥–¥–∞ —è –¥—É–º–∞—é –æ —Å–≤–æ–∏—Ö –¥–µ–ª–∞—Ö –∏ –∑–∞–±–æ—Ç–∞—Ö",
]

# –û—Ç–≤–µ—Ç—ã: 1-2-3-4
ANSWERS = ["1 ‚Äì –ù–µ—Ç, —ç—Ç–æ –Ω–µ —Ç–∞–∫ / –ù–∏–∫–æ–≥–¥–∞", "2 ‚Äì –ü–æ–∂–∞–ª—É–π, —Ç–∞–∫ / –ü–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞", "3 ‚Äì –í–µ—Ä–Ω–æ / –ß–∞—Å—Ç–æ", "4 ‚Äì –°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–µ—Ä–Ω–æ / –ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞"]

# -------------------- –ö–õ–Æ–ß–ò –î–õ–Ø –ü–û–î–°–ß–Å–¢–ê --------------------
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞: –±–∞–ª–ª—ã –∑–∞ –æ—Ç–≤–µ—Ç—ã 1-2-3-4 (–ø–æ –ø–æ—Ä—è–¥–∫—É)
ST_KEY = [          # –°–∏—Ç—É–∞—Ç–∏–≤–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å
    (4,3,2,1), (4,3,2,1), (1,2,3,4), (1,2,3,4), (4,3,2,1),
    (1,2,3,4), (1,2,3,4), (4,3,2,1), (1,2,3,4), (4,3,2,1),
    (4,3,2,1), (1,2,3,4), (1,2,3,4), (1,2,3,4), (4,3,2,1),
    (4,3,2,1), (1,2,3,4), (1,2,3,4), (4,3,2,1), (4,3,2,1)
]

LT_KEY = [          # –õ–∏—á–Ω–æ—Å—Ç–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å
    (4,3,2,1), (1,2,3,4), (1,2,3,4), (1,2,3,4), (1,2,3,4),
    (4,3,2,1), (4,3,2,1), (1,2,3,4), (1,2,3,4), (4,3,2,1),
    (1,2,3,4), (1,2,3,4), (1,2,3,4), (1,2,3,4), (1,2,3,4),
    (4,3,2,1), (1,2,3,4), (1,2,3,4), (4,3,2,1), (1,2,3,4)
]


# -------------------- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –æ—Ç–≤–µ—Ç–∞–º–∏ --------------------
def get_answers_kb(prefix: str):
    builder = InlineKeyboardBuilder()
    for i, text in enumerate(ANSWERS, 1):
        builder.button(text=text, callback_data=f"{prefix}_{i}")
    builder.adjust(1)
    return builder.as_markup()

# -------------------- –°–¢–ê–†–¢ –¢–ï–°–¢–ê --------------------
@test_router.callback_query(F.data == "main_test")
async def cmd_spilberger(call: CallbackQuery, state: FSMContext):
    await state.clear()
    await state.set_state(SpielbergerTest.st_answers)
    await state.update_data(st=[], lt=[])

    await bot.send_message(
        chat_id=call.from_user.id,
        text="""–ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ –≤—ã —Ä–µ—à–∏–ª–∏ –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–≤–æ–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ!
üí° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç–µ –æ–∫–æ–ª–æ 30-40 –º–∏–Ω—É—Ç

–û—Ç–≤–µ—á–∞—è –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–ø—ã—Ç–∞–π—Ç–µ—Å—å —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–≤–æ–µ–º —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ –Ω–µ–¥–µ–ª–∏. 
–ü—Ä–æ—à—É –≤–∞—Å –æ—Ç–≤–µ—á–∞—Ç—å –∏—Å–∫—Ä–µ–Ω–Ω–µ, —ç—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ 
""",
        reply_markup=ReplyKeyboardRemove()
    )
    await asyncio.sleep(3)
    await bot.send_message(
        chat_id=call.from_user.id,
        text=
        "üß† <b>–¢–µ—Å—Ç –°–ø–∏–ª–±–µ—Ä–≥–µ—Ä–∞ ‚Äî –•–∞–Ω–∏–Ω–∞</b>\n\n"
        "–°–µ–π—á–∞—Å –±—É–¥–µ—Ç 20 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –≤–∞—à–µ <b>—Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</b> (—Å–∏—Ç—É–∞—Ç–∏–≤–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å).\n"
        "–û—Ç–≤–µ—á–∞–π—Ç–µ —á–µ—Å—Ç–Ω–æ –∏ –±—ã—Å—Ç—Ä–æ.\n\n"
        f"–í–æ–ø—Ä–æ—Å 1 –∏–∑ {len(ST_QUESTIONS)}\n\n"
        f"<b>{ST_QUESTIONS[0]}</b>",
        reply_markup=get_answers_kb("st")
    )
    await state.set_state(SpielbergerTest.waiting_st_answer)

# -------------------- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –°–¢ --------------------
@test_router.callback_query(F.data.startswith("st_"), SpielbergerTest.waiting_st_answer)
async def process_st_answer(call: CallbackQuery, state: FSMContext):
    data = await state.get_data()
    st_list: list = data["st"]
    answer = int(call.data.split("_")[1])   # 1-4

    st_list.append(answer)
    await state.update_data(st=st_list)

    current_q = len(st_list)

    if current_q < len(ST_QUESTIONS):
        # —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å –°–¢
        await call.message.edit_text(
            f"–í–æ–ø—Ä–æ—Å {current_q + 1} –∏–∑ {len(ST_QUESTIONS)}\n\n"
            f"<b>{ST_QUESTIONS[current_q]}</b>",
            reply_markup=get_answers_kb("st")
        )
    else:
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –õ–¢
        await call.message.edit_text(
            "–û—Ç–ª–∏—á–Ω–æ! –ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞.\n\n"
            "–¢–µ–ø–µ—Ä—å 20 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –≤–∞—Å <b>–≤ —Ü–µ–ª–æ–º, –∫–∞–∫ —á–µ—Ä—Ç—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞</b> (–ª–∏—á–Ω–æ—Å—Ç–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å).\n\n"
            f"–í–æ–ø—Ä–æ—Å 1 –∏–∑ {len(LT_QUESTIONS)}\n\n"
            f"<b>{LT_QUESTIONS[0]}</b>",
            reply_markup=get_answers_kb("lt")
        )
        await state.set_state(SpielbergerTest.waiting_lt_answer)

    await call.answer()

# -------------------- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –õ–¢ --------------------
@test_router.callback_query(F.data.startswith("lt_"), SpielbergerTest.waiting_lt_answer)
async def process_lt_answer(call: CallbackQuery, state: FSMContext):
    data = await state.get_data()
    lt_list: list = data["lt"]
    answer = int(call.data.split("_")[1])

    lt_list.append(answer)
    await state.update_data(lt=lt_list)

    current_q = len(lt_list)

    if current_q < len(LT_QUESTIONS):
        await call.message.edit_text(
            f"–í–æ–ø—Ä–æ—Å {current_q + 1} –∏–∑ {len(LT_QUESTIONS)}\n\n"
            f"<b>{LT_QUESTIONS[current_q]}</b>",
            reply_markup=get_answers_kb("lt")
        )
    else:
        # –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç
        st_answers = data["st"]
        lt_answers = lt_list  # —Ç–æ–ª—å–∫–æ —á—Ç–æ –¥–æ–ø–æ–ª–Ω–∏–ª–∏

        st_score = sum(ST_KEY[i][ans-1] for i, ans in enumerate(st_answers))
        lt_score = sum(LT_KEY[i][ans-1] for i, ans in enumerate(lt_answers))

        def interpret(score: int) -> str:
            if score <= 30:
                return "–Ω–∏–∑–∫–∞—è"
            elif score <= 44:
                return "—É–º–µ—Ä–µ–Ω–Ω–∞—è"
            else:
                return "–≤—ã—Å–æ–∫–∞—è"

        st_level = interpret(st_score)
        lt_level = interpret(lt_score)

        if st_score <=30:
            st_text = "–í –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤–∞—Å –Ω–µ—Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–µ–≤–æ–≥–∏. –í–∞—à–∞ —Ç–µ–∫—É—â–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π, –ª–∏–±–æ –≤–∞—à–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –Ω–µ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ–º –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ–º. "
        elif st_score  <=44:
            st_text = "–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —É–º–µ—Ä–µ–Ω–Ω–æ —Ç—Ä–µ–≤–æ–∂–Ω–æ–π –¥–ª—è –≤–∞—Å. –í —Ü–µ–ª–æ–º –≤—ã —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏, –æ–¥–Ω–∞–∫–æ –∏–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, —Å–∫–æ–≤–∞–Ω–Ω–æ—Å—Ç—å. –ü—Ä–∏ —ç—Ç–æ–º –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ –æ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π."
        else:
            st_text = "–í–µ—Ä–æ—è—Ç–Ω–æ, –≤—ã –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–µ–±—ã–≤–∞–µ—Ç–µ –≤ —Å—Ç—Ä–µ—Å—Å–æ–≤–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤–∞—Å. –£–∂–µ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è –≤—Å—Ç—Ä–µ–≤–æ–∂–µ–Ω–Ω—ã–º, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω—ã–º, —Å–∫–æ–≤–∞–Ω–Ω—ã–º. –ü—Ä–∏—è—Ç–Ω—ã–µ —ç–º–æ—Ü–∏–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ä–µ–∂–µ, —Ç.–∫. –≤—Å–µ –≤–∞—à–∏ –º—ã—Å–ª–∏ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞–µ—Ç –æ—â—É—Ç–∏–º–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ. –¢–∞–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –º–æ–∂–µ—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –≤–∞–º–∏ –∫–∞–∫ —Å–ª–æ–∂–Ω–∞—è –∏–ª–∏ –Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–∞—è –≤ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏."

        if lt_score <=30:
            lt_text = "–í–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏ –≤–∞—Å –º–æ–∂–Ω–æ –æ—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å –∫–∞–∫ –Ω–µ—Ç—Ä–µ–≤–æ–∂–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞. –ß—Ç–æ–±—ã –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–ª–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏, –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –æ–±–ª–∞–¥–∞—Ç—å –≤—ã—Å–æ–∫–æ–π –ª–∏—á–Ω–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç—å—é. –û–¥–Ω–∞–∫–æ –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å —Ç–µ–º, —á—Ç–æ –¥–∞–∂–µ –≤–∞–∂–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –Ω–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–ª—è –≤–∞—Å —Ç—Ä–µ–≤–æ–∂–Ω—ã–º–∏, —á—Ç–æ –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏—é –≤ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏."
        elif lt_score  <=44:
            lt_text = "–ò–Ω–æ–≥–¥–∞ –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –∏ –±—ã—Ç—å –Ω–µ —Å–æ–≤—Å–µ–º –¥–æ–≤–æ–ª—å–Ω—ã–º –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –∏–ª–∏ —Å–≤–æ–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –ü—Ä–∏ —ç—Ç–æ–º –≤—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å —Ö–∞–Ω–¥—Ä–æ–π –∏ –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ –≤ –±–æ–ª—å—à–µ–π —Å—Ç–µ–ø–µ–Ω–∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –Ω–µ–∂–µ–ª–∏ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ. –í–∞—Å –º–æ–∂–Ω–æ –æ—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å –∫–∞–∫ —É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –Ω–æ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ –∏ –≤–æ–ª–Ω–µ–Ω–∏–µ –º–æ–≥—É—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –≤–∞—à–∏—Ö –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è—Ö."
        else:
            lt_text = "–í–∞—à–∞ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å —è–≤–ª—è–µ—Ç—Å—è —É—Å—Ç–æ–π—á–∏–≤–æ–π –ª–∏—á–Ω–æ—Å—Ç–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–æ–π. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –¥–ª—è –≤–∞—Å –Ω–µ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ —Å–ª–æ–∂–∏–≤—à–∞—è—Å—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤ –ª—é–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —É –≤–∞—Å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏. –ú–Ω–æ–≥–∏–µ —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –≤–∞–º–∏ –∫–∞–∫ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —É–≥—Ä–æ–∑–∞ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–µ –∏–ª–∏ –≤–∞—à–µ–º—É –±—É–¥—É—â–µ–º—É. "
        result_text = (
            "–ü—Ä–µ–¥–ª–∞–≥–∞—é –≤–∞–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –æ–±—â–∏–º –∑–∞–∫–ª—é—á–µ–Ω–∏–µ–º, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º –Ω–∞ –≤–∞—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö\n\n"
            f"–°–∏—Ç—É–∞—Ç–∏–≤–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å (–°–¢): <b>{st_score}</b> –±–∞–ª–ª–æ–≤ ‚Üí <b>{st_level}</b>\n"

            f"{st_text}\n\n"
            
            f"–õ–∏—á–Ω–æ—Å—Ç–Ω–∞—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å (–õ–¢): <b>{lt_score}</b> –±–∞–ª–ª–æ–≤ ‚Üí <b>{lt_level}</b>\n\n"
            
            f"{lt_text}\n\n"
            
            "–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:\n"
            "‚Ä¢ –¥–æ 30 ‚Äî –Ω–∏–∑–∫–∞—è\n"
            "‚Ä¢ 31‚Äì44 ‚Äî —É–º–µ—Ä–µ–Ω–Ω–∞—è\n"
            "‚Ä¢ 45+ ‚Äî –≤—ã—Å–æ–∫–∞—è\n\n"
        )

        await call.message.edit_text(result_text, reply_markup=None)
        await bot.send_message(
            chat_id=call.from_user.id,
            text="–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω! –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–≤–µ—Ç—ã ‚ù§Ô∏è",
            reply_markup=menu_keyboard_maker()
        )
        await state.set_state(UserStates.menu)

    await call.answer()