from aiogram import Router, F
from aiogram.fsm.context import FSMContext
from aiogram.types import CallbackQuery, URLInputFile, LabeledPrice, PreCheckoutQuery, InputMediaPhoto, Message

from config import bot
from src.states import UserStates

course_one_router = Router()

@course_one_router.callback_query(UserStates.menu, F.data == "course1")
async def answers(callback_query: CallbackQuery, state: FSMContext):
    await bot.send_photo(
        chat_id=callback_query.from_user.id,
        photo="AgACAgIAAxkBAAICMWk8YUIEVWCNhAqnfFDPaAKJBGT9AAIHGGsbL1noSSiIB3MzBUMnAQADAgADeQADNgQ",
        caption="""–û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ ¬´–¢–µ—Ä–∞–ø–∏—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º¬ª ‚ú®
        
–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

–û–±–Ω–æ–≤–∏—Ç–µ –∏ —É–ø–æ—Ä—è–¥–æ—á–∏—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –≤ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ —Ç—Ä–µ–Ω–∏–Ω–≥–æ–≤–æ–π —Ä–∞–±–æ—Ç–µ üìö
–û—Å–≤–æ–∏—Ç–µ –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –º–µ—Ç–æ–¥–∏–∫–∏ —Ç–µ—Ä–∞–ø–∏–∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ, –∂–∏–≤—ã–µ, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –Ω–∞ 100% üî•
–ù–∞—É—á–∏—Ç–µ—Å—å –±—ã—Å—Ç—Ä–æ –∏ —ç–∫–æ–ª–æ–≥–∏—á–Ω–æ —Å–Ω–∏–º–∞—Ç—å —Å—Ç—Ä–µ—Å—Å, —Ç—Ä–µ–≤–æ–≥—É –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ —á–µ—Ä–µ–∑ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ üé®
–î–æ–±–∞–≤–∏—Ç–µ –≤ —Å–≤–æ—é –∫–æ–ø–∏–ª–∫—É –∫—Ä—É—Ç—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–∞–º–æ–ø–æ–º–æ—â–∏, –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üåü
        """
    )
    await bot.send_message(
        chat_id=callback_query.from_user.id,
        text="""–í—ã –ø–æ–≥—Ä—É–∑–∏—Ç–µ—Å—å –≤ –≤–æ–ª—à–µ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

–¢–µ—Ä–∞–ø–∏—è —Ç–≤–æ—Ä—á–µ—Å–∫–∏–º —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º ‚úçÔ∏è
–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ-–æ–±—Ä–∞–∑–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è (–≠–û–¢) ‚ù§Ô∏è
–ö–∏–Ω–æ—Ç–µ—Ä–∞–ø–∏—è üçø
–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–∞—Ñ–æ—Ä —Å —é–º–æ—Ä–æ–º –∏ –ª—ë–≥–∫–æ—Å—Ç—å—é üòÑ 
        
–í–µ–¥—É—Ç –∫—É—Ä—Å ‚Äî –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–µ –∞–≤—Ç–æ—Ä—ã –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã:
üë©‚Äçüè´ –ì—Ä—É—à–∫–æ –ù–∞—Ç–∞–ª—å—è –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞ ‚Äî —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫.–ø.–Ω., –¥–æ—Ü–µ–Ω—Ç
üë©‚Äçüè´ –ö–∞—Ä–ª–æ–≤—Å–∫–∞—è –ù–∞—Ç–∞–ª—å—è –ù–∏–∫–æ–ª–∞–µ–≤–Ω–∞ ‚Äî –∫.–ø.–Ω., –¥–æ—Ü–µ–Ω—Ç
üë©‚Äçüè´ –ö–æ–∑–ª–æ–≤–∞ –î–∞—Ä—å—è –ï–≤–≥–µ–Ω—å–µ–≤–Ω–∞ ‚Äî —Å—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
üë©‚Äçüè´ –î–∏–Ω–∫–µ–ª–∞–∫–µ—Ä –õ—é–¥–º–∏–ª–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞ ‚Äî —Å—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
–ö–∞—Ñ–µ–¥—Ä–∞ –æ–±—â–µ–π –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ ‚ù§Ô∏è
–ü–æ—Å–ª–µ –∫—É—Ä—Å–∞ –≤—ã —É–π–¥—ë—Ç–µ —Å —Ü–µ–ª—ã–º —á–µ–º–æ–¥–∞–Ω–æ–º –Ω–æ–≤—ã—Ö –∏–¥–µ–π, —Ç—ë–ø–ª—ã–º —Å–µ—Ä–¥—Ü–µ–º –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é, —á—Ç–æ –ø–æ–º–æ–≥–∞—Ç—å –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –∏ —Å —É–ª—ã–±–∫–æ–π üåà
–ñ–¥—ë–º –∏–º–µ–Ω–Ω–æ –≤–∞—Å! üöÄ"""
    )
    invoice_message = await bot.send_invoice(
        chat_id=callback_query.from_user.id,
        title="–ú–æ–¥—É–ª—å 1: ¬´–¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∞—è –º–µ—Ç–∞—Ñ–æ—Ä–∞¬ª (16 –∞–∫. —á–∞—Å–æ–≤) üïä",
        description=f"""–≠—Ç–æ—Ç –∫—É—Ä—Å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤, –∫–æ—É—á–µ–π, —Ç—Ä–µ–Ω–µ—Ä–æ–≤ –∏ –≤—Å–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ–º–æ–≥–∞—Ç—å —Å–µ–±–µ –∏ –¥—Ä—É–≥–∏–º –º—è–≥–∫–æ –∏ –∫—Ä–∞—Å–∏–≤–æ üåø""",
        payload="1",
        provider_token="1744374395:TEST:e5d71d19d5c4ad74014a",
        currency='rub',
        prices=[LabeledPrice(label='–ö—É—Ä—Å', amount=360000)],
        start_parameter='Pay',
        need_name=True,
        need_phone_number=True,
        protect_content=True,
        request_timeout=60,
    )


@course_one_router.pre_checkout_query(UserStates.menu)
async def pre_checkout(query: PreCheckoutQuery, state: FSMContext):
    """
    –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –æ–ø–ª–∞—Ç—ã
    """
    await bot.answer_pre_checkout_query(query.id, ok=True)


@course_one_router.message(F.successful_payment)
async def shipping(message: Message, state: FSMContext):

        await bot.send_message(
            chat_id=message.chat.id,
            text="–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–ø–ª–∞—Ç—É, –≤—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª–∏ –∫—É—Ä—Å"
        )